<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ò–≥—Ä–∞ 3 –≤ —Ä—è–¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            color: #fff;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 480px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        header {
            text-align: center;
            margin-bottom: 15px;
            position: relative;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 5px;
            text-shadow: 0 0 10px #ff00ff;
            background: linear-gradient(to right, #ff8a00, #da1b60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .info-item {
            text-align: center;
            flex: 1;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 3px;
        }
        
        .info-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 8px #00ffff;
        }
        
        .level-bar {
            height: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .level-progress {
            height: 100%;
            background: linear-gradient(to right, #00c9ff, #92fe9d);
            border-radius: 8px;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .level-progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: progress-shine 1.5s infinite;
        }
        
        @keyframes progress-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .game-board-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .game-board {
            display: grid;
            gap: 6px;
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            max-width: 100%;
            width: 100%;
            aspect-ratio: 1/1;
        }
        
        .cell {
            position: relative;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            overflow: hidden;
            background: rgba(50, 50, 50, 0.3);
            transition: transform 0.15s;
        }
        
        .cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
        }
        
        .cell:hover, .cell:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .candy {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: all 0.2s ease;
            z-index: 2;
            position: absolute;
            transition: transform 0.3s ease;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        button {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            flex: 1;
            max-width: 150px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #141e30, #243b55);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            width: 100%;
            box-shadow: 0 0 30px rgba(0, 100, 255, 0.5);
        }
        
        .modal h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .modal p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #ccc;
            line-height: 1.5;
        }
        
        .hidden {
            display: none;
        }
        
        .match-animation {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            animation: match-pulse 0.3s ease-out;
            z-index: 10;
        }
        
        @keyframes match-pulse {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .fall-animation {
            animation: fall 0.3s ease-in;
        }
        
        @keyframes fall {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(0); }
        }
        
        .level-up {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            color: #00ffcc;
            text-shadow: 0 0 15px #00ffcc;
            animation: level-up 1s ease-out;
            opacity: 0;
            z-index: 100;
            pointer-events: none;
            text-align: center;
            width: 100%;
        }
        
        @keyframes level-up {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
        }
        
        .best-score {
            text-align: center;
            margin-top: 15px;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .best-score-value {
            color: gold;
            font-weight: bold;
            text-shadow: 0 0 8px gold;
        }
        
        .footer {
            text-align: center;
            margin-top: 15px;
            color: #aaa;
            font-size: 0.8rem;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π */
        .ice-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(173, 216, 230, 0.8) 0%, rgba(173, 216, 230, 0.3) 70%);
            border-radius: 8px;
            z-index: 5;
            box-shadow: inset 0 0 10px rgba(0, 0, 255, 0.5);
            border: 2px solid rgba(100, 200, 255, 0.8);
        }
        
        .stone {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #444, #222);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
            border: 2px solid #333;
        }
        
        .stone-inner {
            width: 60%;
            height: 60%;
            background: linear-gradient(45deg, #666, #444);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .tutorial {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        
        .tutorial h3 {
            color: #00ffff;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .tutorial p {
            margin-bottom: 10px;
            color: #ccc;
        }
        
        .obstacle-example {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }
        
        .obstacle-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .obstacle-demo {
            width: 50px;
            height: 50px;
            position: relative;
            margin-bottom: 8px;
            border-radius: 8px;
            background: rgba(100, 100, 100, 0.3);
        }
        
        .obstacle-label {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .selected {
            box-shadow: 0 0 0 3px #00ffcc, inset 0 0 10px rgba(0, 255, 204, 0.8);
            z-index: 3;
        }
        
        .falling {
            z-index: 20;
            transition: transform 0.3s cubic-bezier(0.5, 0, 0.5, 1);
        }
        
        .special {
            animation: special-pulse 1s infinite alternate;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
        @keyframes hint-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        
        .hint {
            animation: hint-pulse 1s ease-in-out infinite;
            box-shadow: 0 0 15px gold;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤–∑—Ä—ã–≤–∞ */
        @keyframes explosion {
            0% { transform: scale(0.5); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .explosion {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #ff9900, #ff5500);
            border-radius: 50%;
            animation: explosion 0.5s ease-out;
            z-index: 15;
        }
        
        /* –ù–æ–≤—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è */
        .lava {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #ff5500, #cc0000);
            border-radius: 8px;
            z-index: 5;
            box-shadow: inset 0 0 15px rgba(255, 100, 0, 0.8);
            border: 2px solid rgba(255, 100, 0, 0.8);
        }
        
        .lava-inner {
            position: absolute;
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
            background: radial-gradient(circle, #ff9900, #ff3300);
            border-radius: 50%;
            animation: lava-pulse 2s infinite;
        }
        
        @keyframes lava-pulse {
            0% { transform: scale(0.8); }
            50% { transform: scale(1); }
            100% { transform: scale(0.8); }
        }
        
        .lock {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #aaa, #666);
            border-radius: 8px;
            z-index: 5;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
            border: 2px solid #999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .lock-icon {
            width: 60%;
            height: 60%;
            background: #333;
            border-radius: 50% 50% 0 0;
            position: relative;
        }
        
        .lock-icon::before {
            content: '';
            position: absolute;
            top: -30%;
            left: 50%;
            transform: translateX(-50%);
            width: 40%;
            height: 40%;
            background: #333;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–¢–†–ò –í –†–Ø–î</h1>
        </header>
        
        <div class="game-info">
            <div class="info-item">
                <div class="info-label">–£–†–û–í–ï–ù–¨</div>
                <div class="info-value" id="level">1</div>
            </div>
            <div class="info-item">
                <div class="info-label">–û–ß–ö–ò</div>
                <div class="info-value" id="score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">–¶–ï–õ–¨</div>
                <div class="info-value" id="target">1000</div>
            </div>
        </div>
        
        <div class="level-bar">
            <div class="level-progress" id="levelProgress"></div>
        </div>
        
        <div class="game-board-container">
            <div class="game-board" id="gameBoard"></div>
        </div>
        
        <div class="controls">
            <button id="newGameBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            <button id="hintBtn">–ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
        </div>
        
        <div class="best-score">
            –í–∞—à –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span class="best-score-value" id="bestScore">0</span>
        </div>
        
        <div class="footer">
            –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        </div>
    </div>
    
    <div class="modal hidden" id="levelCompleteModal">
        <div class="modal-content">
            <h2>–£—Ä–æ–≤–µ–Ω—å <span id="completedLevel">1</span> –ø—Ä–æ–π–¥–µ–Ω!</h2>
            <p>–í—ã –Ω–∞–±—Ä–∞–ª–∏ <span id="levelScore">0</span> –æ—á–∫–æ–≤</p>
            <button id="continueBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>
    
    <div class="modal hidden" id="tutorialModal">
        <div class="modal-content">
            <h2>–ù–æ–≤—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è!</h2>
            <div class="tutorial">
                <p>–ù–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –≤–∏–¥—ã –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π:</p>
                
                <div class="obstacle-example">
                    <div class="obstacle-item">
                        <div class="obstacle-demo">
                            <div class="ice-overlay"></div>
                        </div>
                        <div class="obstacle-label">–õ–µ–¥</div>
                    </div>
                    <div class="obstacle-item">
                        <div class="obstacle-demo">
                            <div class="stone">
                                <div class="stone-inner"></div>
                            </div>
                        </div>
                        <div class="obstacle-label">–ö–∞–º–µ–Ω—å</div>
                    </div>
                    <div class="obstacle-item">
                        <div class="obstacle-demo">
                            <div class="lava">
                                <div class="lava-inner"></div>
                            </div>
                        </div>
                        <div class="obstacle-label">–õ–∞–≤–∞</div>
                    </div>
                    <div class="obstacle-item">
                        <div class="obstacle-demo">
                            <div class="lock">
                                <div class="lock-icon"></div>
                            </div>
                        </div>
                        <div class="obstacle-label">–ó–∞–º–æ–∫</div>
                    </div>
                </div>
                
                <h3>–ö–∞–∫ –∏—Ö –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å:</h3>
                <p>‚ùÑÔ∏è <strong>–õ–µ–¥</strong> - —Ç—Ä–µ–±—É–µ—Ç –æ–¥–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ä—è–¥–æ–º, —á—Ç–æ–±—ã —Ä–∞—Å—Ç–∞—è—Ç—å</p>
                <p>ü™® <strong>–ö–∞–º–µ–Ω—å</strong> - —Ç—Ä–µ–±—É–µ—Ç –¥–≤—É—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Ä—è–¥–æ–º, —á—Ç–æ–±—ã —Ä–∞–∑—Ä—É—à–∏—Ç—å—Å—è</p>
                <p>üî• <strong>–õ–∞–≤–∞</strong> - —Ç—Ä–µ–±—É–µ—Ç –¥–≤—É—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Ä—è–¥–æ–º, –ø—Ä–∏ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–∏ –≤–∑—Ä—ã–≤–∞–µ—Ç —Å–æ—Å–µ–¥–Ω–∏–µ –∫–æ–Ω—Ñ–µ—Ç—ã</p>
                <p>üîí <strong>–ó–∞–º–æ–∫</strong> - —Ç—Ä–µ–±—É–µ—Ç —Ç—Ä–µ—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Ä—è–¥–æ–º, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å—Å—è</p>
                <p>–° –∫–∞–∂–¥—ã–º —É—Ä–æ–≤–Ω–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –±—É–¥–µ—Ç –±–æ–ª—å—à–µ!</p>
            </div>
            <button id="tutorialBtn">–ü–æ–Ω—è—Ç–Ω–æ!</button>
        </div>
    </div>
    
    <div class="modal hidden" id="pauseModal">
        <div class="modal-content">
            <h2>–ü–ê–£–ó–ê</h2>
            <p>–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>
            <button id="resumeBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>
    
    <div class="level-up hidden" id="levelUp">–£–†–û–í–ï–ù–¨ –ü–†–û–ô–î–ï–ù!</div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const BASE_BOARD_SIZE = 6;
        const CANDY_TYPES = 6;
        const LEVEL_TARGET_MULTIPLIER = 1.5;
        const OBSTACLES = {
            ICE: 100,
            STONE: 101,
            LAVA: 102,
            LOCK: 103
        };
        
        // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–µ—Ç—ã
        const SPECIAL_CANDIES = {
            BOMB: 50,
            ARROW_UP: 51,
            ARROW_RIGHT: 52,
            ARROW_DOWN: 53,
            ARROW_LEFT: 54
        };
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            board: [],
            score: 0,
            level: 1,
            target: 0,
            selectedCandy: null,
            isSwapping: false,
            isProcessing: false,
            bestScore: 0,
            touchStartX: 0,
            touchStartY: 0,
            touchStartTime: 0,
            obstacles: [],
            tutorialShown: false,
            fallFrom: {},
            isPaused: false
        };
        
        // –û—á–µ—Ä–µ–¥—å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–ø–µ—Ü–∫–æ–Ω—Ñ–µ—Ç
        let activationQueue = [];
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const gameBoard = document.getElementById('gameBoard');
        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('level');
        const targetElement = document.getElementById('target');
        const levelProgress = document.getElementById('levelProgress');
        const levelCompleteModal = document.getElementById('levelCompleteModal');
        const completedLevelElement = document.getElementById('completedLevel');
        const levelScoreElement = document.getElementById('levelScore');
        const continueBtn = document.getElementById('continueBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const levelUpElement = document.getElementById('levelUp');
        const bestScoreElement = document.getElementById('bestScore');
        const tutorialModal = document.getElementById('tutorialModal');
        const tutorialBtn = document.getElementById('tutorialBtn');
        const pauseModal = document.getElementById('pauseModal');
        const resumeBtn = document.getElementById('resumeBtn');
        const hintBtn = document.getElementById('hintBtn');
        
        // –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –¥–æ—Å–∫–∏
        function getBoardSize() {
            return gameState.level >= 10 ? 8 : BASE_BOARD_SIZE;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGameState();
            startGame();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            continueBtn.addEventListener('click', () => {
                levelCompleteModal.classList.add('hidden');
                goToNextLevel();
            });
            
            tutorialBtn.addEventListener('click', () => {
                tutorialModal.classList.add('hidden');
                gameState.tutorialShown = true;
                saveGameState();
            });
            
            newGameBtn.addEventListener('click', () => {
                if (confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É? –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.')) {
                    resetGame();
                    startGame();
                }
            });
            
            resumeBtn.addEventListener('click', () => {
                pauseModal.classList.add('hidden');
                gameState.isPaused = false;
            });
            
            hintBtn.addEventListener('click', showHints);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–≤–∞–π–ø–æ–≤
            gameBoard.addEventListener('touchstart', handleTouchStart, { passive: false });
            gameBoard.addEventListener('touchend', handleTouchEnd, { passive: false });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–∞—É–∑—ã –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –æ–∫–Ω–∞
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden' && !gameState.isProcessing && !gameState.isPaused) {
                    gameState.isPaused = true;
                    pauseModal.classList.remove('hidden');
                }
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞ –∫–∞—Å–∞–Ω–∏—è
        function handleTouchStart(e) {
            if (gameState.isProcessing || gameState.isPaused) return;
            
            const touch = e.touches[0];
            gameState.touchStartX = touch.clientX;
            gameState.touchStartY = touch.clientY;
            gameState.touchStartTime = Date.now();
            
            const cell = touch.target.closest('.cell');
            if (cell) {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                
                // –í—ã–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—É
                if (!gameState.selectedCandy) {
                    selectCandy(row, col);
                }
            }
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
            e.preventDefault();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–∞—Å–∞–Ω–∏—è
        function handleTouchEnd(e) {
            if (gameState.isProcessing || !gameState.selectedCandy || gameState.isPaused) return;
            
            const touch = e.changedTouches[0];
            const endX = touch.clientX;
            const endY = touch.clientY;
            const endTime = Date.now();
            
            const dx = endX - gameState.touchStartX;
            const dy = endY - gameState.touchStartY;
            const dt = endTime - gameState.touchStartTime;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞
            if (dt > 500 || (Math.abs(dx) < 20 && Math.abs(dy) < 20)) return;
            
            const [startRow, startCol] = gameState.selectedCandy;
            let targetRow = startRow;
            let targetCol = startCol;
            
            if (Math.abs(dx) > Math.abs(dy)) {
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                if (dx > 30) targetCol++; // –í–ø—Ä–∞–≤–æ
                else if (dx < -30) targetCol--; // –í–ª–µ–≤–æ
            } else {
                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                if (dy > 30) targetRow++; // –í–Ω–∏–∑
                else if (dy < -30) targetRow--; // –í–≤–µ—Ä—Ö
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ü–µ–ª–µ–≤–∞—è —è—á–µ–π–∫–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ—Å–∫–∏
            const boardSize = getBoardSize();
            if (targetRow >= 0 && targetRow < boardSize && targetCol >= 0 && targetCol < boardSize) {
                selectCandy(targetRow, targetCol);
            }
            
            e.preventDefault();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –∏–∑ localStorage
        function loadGameState() {
            const savedGame = localStorage.getItem('match3Game');
            if (savedGame) {
                try {
                    const parsedGame = JSON.parse(savedGame);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –∏–≥—Ä–∞ –∏–º–µ–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
                    if (parsedGame.board && parsedGame.score !== undefined && 
                        parsedGame.level !== undefined) {
                        gameState = parsedGame;
                        
                        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ obstacles - –º–∞—Å—Å–∏–≤
                        if (!Array.isArray(gameState.obstacles)) {
                            gameState.obstacles = [];
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        if (gameState.score > gameState.bestScore) {
                            gameState.bestScore = gameState.score;
                        }
                        
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–ª–∞–≥–∏
                        gameState.isProcessing = false;
                        gameState.isSwapping = false;
                        gameState.selectedCandy = null;
                        gameState.isPaused = false;
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã:', e);
                    resetGame();
                }
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            levelCompleteModal.classList.add('hidden');
            tutorialModal.classList.add('hidden');
            pauseModal.classList.add('hidden');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –≤ localStorage
        function saveGameState() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (gameState.score > gameState.bestScore) {
                gameState.bestScore = gameState.score;
                bestScoreElement.textContent = formatNumber(gameState.bestScore);
            }
            
            localStorage.setItem('match3Game', JSON.stringify(gameState));
        }
        
        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            // –ï—Å–ª–∏ –∏–≥—Ä–∞ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∏–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            if (gameState.level === 0 || gameState.board.length === 0) {
                resetGame();
            }
            
            // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ obstacles - –º–∞—Å—Å–∏–≤
            if (!Array.isArray(gameState.obstacles)) {
                gameState.obstacles = [];
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ 2, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏
            if (gameState.level >= 2 && !gameState.tutorialShown && gameState.level < 3) {
                tutorialModal.classList.remove('hidden');
            }
            
            updateUI();
            renderBoard();
        }
        
        // –°–±—Ä–æ—Å –∏–≥—Ä—ã
        function resetGame() {
            gameState.level = 1;
            gameState.score = 0;
            gameState.target = Math.floor(1000 * Math.pow(LEVEL_TARGET_MULTIPLIER, gameState.level - 1));
            gameState.selectedCandy = null;
            gameState.isSwapping = false;
            gameState.isProcessing = false;
            gameState.obstacles = [];
            gameState.tutorialShown = false;
            gameState.fallFrom = {};
            gameState.isPaused = false;
            
            generateBoard();
            updateUI();
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        function generateBoard() {
            const boardSize = getBoardSize();
            let validBoard = false;
            let attempts = 0;
            const maxAttempts = 50;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞
            gameState.board = [];
            for (let i = 0; i < boardSize; i++) {
                gameState.board[i] = new Array(boardSize).fill(0);
            }
            
            while (!validBoard && attempts < maxAttempts) {
                attempts++;
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –∫–æ–Ω—Ñ–µ—Ç–∞–º–∏
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col < boardSize; col++) {
                        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —è—á–µ–π–∫–∏ —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
                        if (gameState.board[row][col] > 0) continue;
                        
                        let candyType;
                        let validCandy = false;
                        let candyAttempts = 0;
                        const maxCandyAttempts = 10;
                        
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–µ—Ç—É, –∏–∑–±–µ–≥–∞—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                        do {
                            candyType = Math.floor(Math.random() * CANDY_TYPES) + 1;
                            candyAttempts++;
                            
                            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                            let hasVerticalMatch = false;
                            if (row >= 2) {
                                hasVerticalMatch = (
                                    gameState.board[row-1][col] === candyType && 
                                    gameState.board[row-2][col] === candyType
                                );
                            }
                            
                            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                            let hasHorizontalMatch = false;
                            if (col >= 2) {
                                hasHorizontalMatch = (
                                    gameState.board[row][col-1] === candyType && 
                                    gameState.board[row][col-2] === candyType
                                );
                            }
                            
                            validCandy = !hasVerticalMatch && !hasHorizontalMatch;
                            
                        } while (!validCandy && candyAttempts < maxCandyAttempts);
                        
                        gameState.board[row][col] = candyType;
                    }
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è
                addObstacles();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ö–æ–¥–æ–≤
                validBoard = hasMoves();
            }
            
            if (!validBoard) {
                console.log("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–Ω–æ–µ –ø–æ–ª–µ –ø–æ—Å–ª–µ " + maxAttempts + " –ø–æ–ø—ã—Ç–æ–∫. –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º...");
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–ª–µ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
                generateSimpleBoard();
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–ª—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
        function generateSimpleBoard() {
            const boardSize = getBoardSize();
            for (let row = 0; row < boardSize; row++) {
                gameState.board[row] = [];
                for (let col = 0; col < boardSize; col++) {
                    gameState.board[row][col] = Math.floor(Math.random() * CANDY_TYPES) + 1;
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            addObstacles();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function addObstacles() {
            const boardSize = getBoardSize();
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            gameState.obstacles = [];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è
            if (gameState.level >= 2) {
                // –õ–µ–¥
                const iceCount = Math.min(2 + gameState.level, Math.floor(boardSize * boardSize * 0.15));
                for (let i = 0; i < iceCount; i++) {
                    const row = Math.floor(Math.random() * boardSize);
                    const col = Math.floor(Math.random() * boardSize);
                    
                    // –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —É–∂–µ –∑–∞–Ω—è—Ç—ã–µ –∫–ª–µ—Ç–∫–∏
                    if (!getObstacleAt(row, col)) {
                        gameState.obstacles.push({type: OBSTACLES.ICE, row, col});
                    }
                }
            }
            
            if (gameState.level >= 3) {
                // –ö–∞–º–Ω–∏
                const stoneCount = Math.min(1 + Math.floor(gameState.level / 2), Math.floor(boardSize * boardSize * 0.1));
                for (let i = 0; i < stoneCount; i++) {
                    const row = Math.floor(Math.random() * boardSize);
                    const col = Math.floor(Math.random() * boardSize);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –Ω–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
                    if (!getObstacleAt(row, col)) {
                        gameState.obstacles.push({type: OBSTACLES.STONE, row, col});
                    }
                }
            }
            
            if (gameState.level >= 5) {
                // –õ–∞–≤–∞
                const lavaCount = Math.min(1 + Math.floor((gameState.level - 4) / 2), Math.floor(boardSize * boardSize * 0.1));
                for (let i = 0; i < lavaCount; i++) {
                    const row = Math.floor(Math.random() * boardSize);
                    const col = Math.floor(Math.random() * boardSize);
                    
                    if (!getObstacleAt(row, col)) {
                        gameState.obstacles.push({type: OBSTACLES.LAVA, row, col});
                    }
                }
            }
            
            if (gameState.level >= 10) {
                // –ó–∞–º–∫–∏
                const lockCount = Math.min(1 + Math.floor((gameState.level - 9) / 2), Math.floor(boardSize * boardSize * 0.1));
                for (let i = 0; i < lockCount; i++) {
                    const row = Math.floor(Math.random() * boardSize);
                    const col = Math.floor(Math.random() * boardSize);
                    
                    if (!getObstacleAt(row, col)) {
                        gameState.obstacles.push({type: OBSTACLES.LOCK, row, col});
                    }
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –≤ —è—á–µ–π–∫–µ
        function getObstacleAt(row, col) {
            if (!gameState.obstacles) return null;
            return gameState.obstacles.find(obs => obs.row === row && obs.col === col) || null;
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        function removeObstacle(row, col) {
            if (!gameState.obstacles) return false;
            const index = gameState.obstacles.findIndex(obs => obs.row === row && obs.col === col);
            if (index !== -1) {
                gameState.obstacles.splice(index, 1);
                return true;
            }
            return false;
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
        function renderBoard() {
            const boardSize = getBoardSize();
            gameBoard.innerHTML = '';
            gameBoard.style.gridTemplateColumns = `repeat(${boardSize}, 1fr)`;
            
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    const candyValue = gameState.board[row][col];
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ñ–µ—Ç—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
                    if (candyValue > 0) {
                        const candy = document.createElement('img');
                        candy.className = 'candy';
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–æ–Ω—Ñ–µ—Ç–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π
                        if (candyValue >= 50) {
                            candy.classList.add('special');
                            switch(candyValue) {
                                case SPECIAL_CANDIES.BOMB:
                                    candy.src = 'bomb.png';
                                    candy.alt = '–ë–æ–º–±–æ—á–∫–∞';
                                    break;
                                case SPECIAL_CANDIES.ARROW_UP:
                                    candy.src = 'arrow_up.png';
                                    candy.alt = '–°—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö';
                                    break;
                                case SPECIAL_CANDIES.ARROW_RIGHT:
                                    candy.src = 'arrow_right.png';
                                    candy.alt = '–°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ';
                                    break;
                                case SPECIAL_CANDIES.ARROW_DOWN:
                                    candy.src = 'arrow_down.png';
                                    candy.alt = '–°—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑';
                                    break;
                                case SPECIAL_CANDIES.ARROW_LEFT:
                                    candy.src = 'arrow_left.png';
                                    candy.alt = '–°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ';
                                    break;
                                default:
                                    candy.src = `candy${candyValue}.png`;
                                    candy.alt = `–ö–æ–Ω—Ñ–µ—Ç–∞ ${candyValue}`;
                            }
                        } else {
                            candy.src = `candy${candyValue}.png`;
                            candy.alt = `–ö–æ–Ω—Ñ–µ—Ç–∞ ${candyValue}`;
                        }
                        
                        cell.appendChild(candy);
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
                    const obstacle = getObstacleAt(row, col);
                    if (obstacle) {
                        if (obstacle.type === OBSTACLES.ICE) {
                            const iceOverlay = document.createElement('div');
                            iceOverlay.className = 'ice-overlay';
                            cell.appendChild(iceOverlay);
                        } else if (obstacle.type === OBSTACLES.STONE) {
                            const stone = document.createElement('div');
                            stone.className = 'stone';
                            const stoneInner = document.createElement('div');
                            stoneInner.className = 'stone-inner';
                            stone.appendChild(stoneInner);
                            cell.appendChild(stone);
                        } else if (obstacle.type === OBSTACLES.LAVA) {
                            const lava = document.createElement('div');
                            lava.className = 'lava';
                            const lavaInner = document.createElement('div');
                            lavaInner.className = 'lava-inner';
                            lava.appendChild(lavaInner);
                            cell.appendChild(lava);
                        } else if (obstacle.type === OBSTACLES.LOCK) {
                            const lock = document.createElement('div');
                            lock.className = 'lock';
                            const lockIcon = document.createElement('div');
                            lockIcon.className = 'lock-icon';
                            lock.appendChild(lockIcon);
                            cell.appendChild(lock);
                        }
                    }
                    
                    cell.addEventListener('click', () => {
                        if (!gameState.isPaused) selectCandy(row, col);
                    });
                    gameBoard.appendChild(cell);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —è—á–µ–π–∫–∏
        function updateCell(row, col) {
            const boardSize = getBoardSize();
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            if (!cell) return;
            
            cell.innerHTML = '';
            
            const candyValue = gameState.board[row][col];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ñ–µ—Ç—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
            if (candyValue > 0) {
                const candy = document.createElement('img');
                candy.className = 'candy';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–æ–Ω—Ñ–µ—Ç–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π
                if (candyValue >= 50) {
                    candy.classList.add('special');
                    switch(candyValue) {
                        case SPECIAL_CANDIES.BOMB:
                            candy.src = 'bomb.png';
                            candy.alt = '–ë–æ–º–±–æ—á–∫–∞';
                            break;
                        case SPECIAL_CANDIES.ARROW_UP:
                            candy.src = 'arrow_up.png';
                            candy.alt = '–°—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö';
                            break;
                        case SPECIAL_CANDIES.ARROW_RIGHT:
                            candy.src = 'arrow_right.png';
                            candy.alt = '–°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ';
                            break;
                        case SPECIAL_CANDIES.ARROW_DOWN:
                            candy.src = 'arrow_down.png';
                            candy.alt = '–°—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑';
                            break;
                        case SPECIAL_CANDIES.ARROW_LEFT:
                            candy.src = 'arrow_left.png';
                            candy.alt = '–°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ';
                            break;
                        default:
                            candy.src = `candy${candyValue}.png`;
                            candy.alt = `–ö–æ–Ω—Ñ–µ—Ç–∞ ${candyValue}`;
                    }
                } else {
                    candy.src = `candy${candyValue}.png`;
                    candy.alt = `–ö–æ–Ω—Ñ–µ—Ç–∞ ${candyValue}`;
                }
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è
                if (gameState.fallFrom[`${row},${col}`]) {
                    const [fromRow] = gameState.fallFrom[`${row},${col}`];
                    const distance = row - fromRow;
                    candy.style.transform = `translateY(${-distance * 100}%)`;
                    candy.classList.add('falling');
                    
                    setTimeout(() => {
                        candy.style.transform = 'translateY(0)';
                        setTimeout(() => {
                            candy.classList.remove('falling');
                        }, 300);
                    }, 10);
                }
                
                cell.appendChild(candy);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            const obstacle = getObstacleAt(row, col);
            if (obstacle) {
                if (obstacle.type === OBSTACLES.ICE) {
                    const iceOverlay = document.createElement('div');
                    iceOverlay.className = 'ice-overlay';
                    cell.appendChild(iceOverlay);
                } else if (obstacle.type === OBSTACLES.STONE) {
                    const stone = document.createElement('div');
                    stone.className = 'stone';
                    const stoneInner = document.createElement('div');
                    stoneInner.className = 'stone-inner';
                    stone.appendChild(stoneInner);
                    cell.appendChild(stone);
                } else if (obstacle.type === OBSTACLES.LAVA) {
                    const lava = document.createElement('div');
                    lava.className = 'lava';
                    const lavaInner = document.createElement('div');
                    lavaInner.className = 'lava-inner';
                    lava.appendChild(lavaInner);
                    cell.appendChild(lava);
                } else if (obstacle.type === OBSTACLES.LOCK) {
                    const lock = document.createElement('div');
                    lock.className = 'lock';
                    const lockIcon = document.createElement('div');
                    lockIcon.className = 'lock-icon';
                    lock.appendChild(lockIcon);
                    cell.appendChild(lock);
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            cell.addEventListener('click', () => {
                if (!gameState.isPaused) selectCandy(row, col);
            });
        }
        
        // –í—ã–±–æ—Ä –∫–æ–Ω—Ñ–µ—Ç—ã
        function selectCandy(row, col) {
            if (gameState.isProcessing || gameState.isPaused) return;
            const boardSize = getBoardSize();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è —è—á–µ–π–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–µ—Ç–æ–π
            const candyValue = gameState.board[row][col];
            if (candyValue >= 50) {
                activateSpecial(row, col, candyValue);
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —è—á–µ–π–∫–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ
            const obstacle = getObstacleAt(row, col);
            if (obstacle && (obstacle.type === OBSTACLES.STONE || obstacle.type === OBSTACLES.LOCK)) return;
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            
            // –ï—Å–ª–∏ –∫–æ–Ω—Ñ–µ—Ç–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞
            if (gameState.selectedCandy) {
                const [prevRow, prevCol] = gameState.selectedCandy;
                const prevCell = document.querySelector(`.cell[data-row="${prevRow}"][data-col="${prevCol}"]`);
                
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ —Ç–∞ –∂–µ —Å–∞–º–∞—è –∫–æ–Ω—Ñ–µ—Ç–∞ - —Å–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                if (prevRow === row && prevCol === col) {
                    prevCell.classList.remove('selected');
                    gameState.selectedCandy = null;
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è—é—Ç—Å—è –ª–∏ –∫–æ–Ω—Ñ–µ—Ç—ã —Å–æ—Å–µ–¥—è–º–∏
                const isNeighbor = 
                    (Math.abs(prevRow - row) === 1 && prevCol === col) || 
                    (Math.abs(prevCol - col) === 1 && prevRow === row);
                
                if (isNeighbor) {
                    gameState.isSwapping = true;
                    
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–æ–Ω—Ñ–µ—Ç—ã
                    prevCell.classList.remove('selected');
                    
                    // –ú–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–µ—Ç—ã –º–µ—Å—Ç–∞–º–∏
                    swapCandies(prevRow, prevCol, row, col, () => {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–±—Ä–∞–∑–æ–≤–∞–ª–∏—Å—å –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                        const matches = findMatches();
                        
                        if (matches.length > 0) {
                            // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Ö
                            processMatches(matches);
                        } else {
                            // –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ
                            swapCandies(prevRow, prevCol, row, col, () => {
                                gameState.isSwapping = false;
                                gameState.selectedCandy = null;
                            });
                        }
                    });
                } else {
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–æ–Ω—Ñ–µ—Ç—ã
                    prevCell.classList.remove('selected');
                    // –í—ã–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–µ—Ç—É
                    cell.classList.add('selected');
                    gameState.selectedCandy = [row, col];
                }
            } else {
                // –í—ã–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–µ—Ç—É
                cell.classList.add('selected');
                gameState.selectedCandy = [row, col];
            }
        }
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–µ—Ç—ã
        function activateSpecial(row, col, type) {
            if (gameState.isProcessing || gameState.isPaused) return;
            const boardSize = getBoardSize();
            
            gameState.isProcessing = true;
            
            const cellsToRemove = [];
            let scoreToAdd = 0;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∞–º—É —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–µ—Ç—É
            cellsToRemove.push([row, col]);
            scoreToAdd += 50;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤–∑—Ä—ã–≤–∞
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            if (cell) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion';
                cell.appendChild(explosion);
                
                setTimeout(() => {
                    explosion.remove();
                }, 500);
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–æ–Ω—Ñ–µ—Ç—ã
            switch(type) {
                case SPECIAL_CANDIES.BOMB: // –ë–æ–º–±–æ—á–∫–∞
                    // –í–∑—Ä—ã–≤–∞–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏
                    const bombDirections = [
                        [-1, -1], [-1, 0], [-1, 1],
                        [0, -1],           [0, 1],
                        [1, -1],  [1, 0],  [1, 1]
                    ];
                    bombDirections.forEach(([dx, dy]) => {
                        const newRow = row + dx;
                        const newCol = col + dy;
                        if (newRow >= 0 && newRow < boardSize && newCol >= 0 && newCol < boardSize) {
                            cellsToRemove.push([newRow, newCol]);
                            scoreToAdd += 20;
                            
                            // –ê–Ω–∏–º–∞—Ü–∏—è –≤–∑—Ä—ã–≤–∞ –¥–ª—è —Å–æ—Å–µ–¥–µ–π
                            const neighborCell = document.querySelector(`.cell[data-row="${newRow}"][data-col="${newCol}"]`);
                            if (neighborCell) {
                                const explosion = document.createElement('div');
                                explosion.className = 'explosion';
                                neighborCell.appendChild(explosion);
                                
                                setTimeout(() => {
                                    explosion.remove();
                                }, 500);
                            }
                        }
                    });
                    break;
                    
                case SPECIAL_CANDIES.ARROW_UP: // –°—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö
                    for (let r = row - 1; r >= 0; r--) {
                        cellsToRemove.push([r, col]);
                        scoreToAdd += 10;
                    }
                    break;
                    
                case SPECIAL_CANDIES.ARROW_RIGHT: // –°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ
                    for (let c = col + 1; c < boardSize; c++) {
                        cellsToRemove.push([row, c]);
                        scoreToAdd += 10;
                    }
                    break;
                    
                case SPECIAL_CANDIES.ARROW_DOWN: // –°—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑
                    for (let r = row + 1; r < boardSize; r++) {
                        cellsToRemove.push([r, col]);
                        scoreToAdd += 10;
                    }
                    break;
                    
                case SPECIAL_CANDIES.ARROW_LEFT: // –°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ
                    for (let c = col - 1; c >= 0; c--) {
                        cellsToRemove.push([row, c]);
                        scoreToAdd += 10;
                    }
                    break;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –¥—Ä—É–≥–∏–µ —Å–ø–µ—Ü–∫–æ–Ω—Ñ–µ—Ç—ã –¥–ª—è –∫–∞—Å–∫–∞–¥–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
            const nextSpecials = [];
            
            // –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ñ–µ—Ç—ã –∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            cellsToRemove.forEach(([r, c]) => {
                // –î–ª—è —Å–ø–µ—Ü–∫–æ–Ω—Ñ–µ—Ç (–∫—Ä–æ–º–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º–æ–π) - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
                if (gameState.board[r][c] >= 50 && !(r === row && c === col)) {
                    nextSpecials.push([r, c, gameState.board[r][c]]);
                } else {
                    // –û–±—ã—á–Ω—ã–µ –∫–æ–Ω—Ñ–µ—Ç—ã —É–¥–∞–ª—è–µ–º
                    gameState.board[r][c] = 0;
                    removeObstacle(r, c);
                }
                updateCell(r, c);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
                const cell = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
                if (cell) {
                    const animation = document.createElement('div');
                    animation.className = 'match-animation';
                    cell.appendChild(animation);
                    
                    setTimeout(() => {
                        animation.remove();
                    }, 300);
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∫–æ–Ω—Ñ–µ—Ç—ã –≤ –æ—á–µ—Ä–µ–¥—å
            nextSpecials.forEach(([r, c, t]) => {
                activationQueue.push({row: r, col: c, type: t});
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏
            gameState.score += scoreToAdd;
            updateUI();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏
            if (activationQueue.length > 0) {
                setTimeout(() => {
                    const next = activationQueue.shift();
                    activateSpecial(next.row, next.col, next.type);
                }, 500);
            } else {
                setTimeout(() => {
                    dropCandies();
                }, 300);
            }
        }
        
        // –û–±–º–µ–Ω –∫–æ–Ω—Ñ–µ—Ç –º–µ—Å—Ç–∞–º–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        function swapCandies(row1, col1, row2, col2, callback) {
            // –ú–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–µ—Ç—ã –≤ –º–∞—Å—Å–∏–≤–µ
            const temp = gameState.board[row1][col1];
            gameState.board[row1][col1] = gameState.board[row2][col2];
            gameState.board[row2][col2] = temp;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateCell(row1, col1);
            updateCell(row2, col2);
            
            // –í—ã–∑—ã–≤–∞–µ–º callback –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(callback, 200);
        }
        
        // –ü–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
        function findMatches() {
            const boardSize = getBoardSize();
            const matches = [];
            const visited = new Set();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize - 2; col++) {
                    const candyType = gameState.board[row][col];
                    if (candyType === 0 || candyType >= 50) continue; // –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞ –∏–ª–∏ —Å–ø–µ—Ü. –∫–æ–Ω—Ñ–µ—Ç–∞
                    
                    if (candyType === gameState.board[row][col+1] && 
                        candyType === gameState.board[row][col+2]) {
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—Ö–æ–¥–∏—Ç –ª–∏ —É–∂–µ —ç—Ç–∞ —è—á–µ–π–∫–∞ –≤ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                        if (visited.has(`${row},${col}`)) continue;
                        
                        const match = [[row, col], [row, col+1], [row, col+2]];
                        visited.add(`${row},${col}`);
                        visited.add(`${row},${col+1}`);
                        visited.add(`${row},${col+2}`);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª–∏–Ω–Ω–µ–µ 3
                        let nextCol = col + 3;
                        while (nextCol < boardSize && gameState.board[row][nextCol] === candyType) {
                            match.push([row, nextCol]);
                            visited.add(`${row},${nextCol}`);
                            nextCol++;
                        }
                        
                        matches.push(match);
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            for (let row = 0; row < boardSize - 2; row++) {
                for (let col = 0; col < boardSize; col++) {
                    const candyType = gameState.board[row][col];
                    if (candyType === 0 || candyType >= 50) continue; // –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞ –∏–ª–∏ —Å–ø–µ—Ü. –∫–æ–Ω—Ñ–µ—Ç–∞
                    
                    if (candyType === gameState.board[row+1][col] && 
                        candyType === gameState.board[row+2][col]) {
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—Ö–æ–¥–∏—Ç –ª–∏ —É–∂–µ —ç—Ç–∞ —è—á–µ–π–∫–∞ –≤ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                        if (visited.has(`${row},${col}`)) continue;
                        
                        const match = [[row, col], [row+1, col], [row+2, col]];
                        visited.add(`${row},${col}`);
                        visited.add(`${row+1},${col}`);
                        visited.add(`${row+2},${col}`);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª–∏–Ω–Ω–µ–µ 3
                        let nextRow = row + 3;
                        while (nextRow < boardSize && gameState.board[nextRow][col] === candyType) {
                            match.push([nextRow, col]);
                            visited.add(`${nextRow},${col}`);
                            nextRow++;
                        }
                        
                        matches.push(match);
                    }
                }
            }
            
            // –ü–æ–∏—Å–∫ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ 2x2
            for (let row = 0; row < boardSize - 1; row++) {
                for (let col = 0; col < boardSize - 1; col++) {
                    const candyType = gameState.board[row][col];
                    if (!candyType || candyType >= 50) continue;
                    
                    if (candyType === gameState.board[row][col+1] &&
                        candyType === gameState.board[row+1][col] &&
                        candyType === gameState.board[row+1][col+1]) {
                        
                        const square = [
                            [row, col], [row, col+1],
                            [row+1, col], [row+1, col+1]
                        ];
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏
                        let isNew = true;
                        square.forEach(([r, c]) => {
                            if (visited.has(`${r},${c}`)) isNew = false;
                        });
                        
                        if (isNew) {
                            matches.push(square);
                            square.forEach(([r, c]) => visited.add(`${r},${c}`));
                        }
                    }
                }
            }
            
            return matches;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function processMatches(matches) {
            if (matches.length === 0) {
                gameState.isSwapping = false;
                gameState.selectedCandy = null;
                return;
            }
            
            const boardSize = getBoardSize();
            gameState.isProcessing = true;
            
            // –£–¥–∞–ª—è–µ–º —Å–æ–≤–ø–∞–≤—à–∏–µ –∫–æ–Ω—Ñ–µ—Ç—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏
            let totalScore = 0;
            const matchedCells = [];
            const specialCells = [];
            
            matches.forEach(match => {
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏ –∑–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                const matchScore = 10 * match.length * gameState.level;
                totalScore += matchScore;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–æ–º 2x2
                const isSquare = match.length === 4 && 
                                Math.max(...match.map(cell => cell[0])) - Math.min(...match.map(cell => cell[0])) === 1 &&
                                Math.max(...match.map(cell => cell[1])) - Math.min(...match.map(cell => cell[1])) === 1;
                
                // –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–µ—Ç—É –¥–ª—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∏–∑ 4 –∏ –±–æ–ª–µ–µ –∫–æ–Ω—Ñ–µ—Ç
                let specialType = null;
                if (match.length >= 4) {
                    // –î–ª—è –∫–≤–∞–¥—Ä–∞—Ç–∞ 2x2 –∏–ª–∏ 5+ –∫–æ–Ω—Ñ–µ—Ç —Å–æ–∑–¥–∞–µ–º –±–æ–º–±–æ—á–∫—É
                    if (match.length >= 5 || isSquare) {
                        specialType = SPECIAL_CANDIES.BOMB;
                    } else {
                        // –î–ª—è 4 –∫–æ–Ω—Ñ–µ—Ç –≤ —Ä—è–¥ —Å–æ–∑–¥–∞–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫—É
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä—è–¥–∞
                        const isHorizontal = match[0][0] === match[1][0];
                        if (isHorizontal) {
                            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä—è–¥ - —Å—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ –∏–ª–∏ –≤–ø—Ä–∞–≤–æ
                            specialType = Math.random() < 0.5 ? SPECIAL_CANDIES.ARROW_LEFT : SPECIAL_CANDIES.ARROW_RIGHT;
                        } else {
                            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä—è–¥ - —Å—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö –∏–ª–∏ –≤–Ω–∏–∑
                            specialType = Math.random() < 0.5 ? SPECIAL_CANDIES.ARROW_UP : SPECIAL_CANDIES.ARROW_DOWN;
                        }
                    }
                    
                    // –í—ã–±–∏—Ä–∞–µ–º —Ü–µ–Ω—Ç—Ä —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–µ—Ç—ã
                    const centerRow = Math.floor(match.reduce((sum, [r]) => sum + r, 0) / match.length);
                    const centerCol = Math.floor(match.reduce((sum, [, c]) => sum + c, 0) / match.length);
                    
                    specialCells.push({
                        row: centerRow,
                        col: centerCol,
                        type: specialType
                    });
                    
                    // –£–¥–∞–ª—è–µ–º —ç—Ç—É —è—á–µ–π–∫—É –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
                    const index = match.findIndex(([r, c]) => r === centerRow && c === centerCol);
                    if (index !== -1) {
                        match.splice(index, 1);
                    }
                }
                
                // –ü–æ–º–µ—á–∞–µ–º —Å–æ–≤–ø–∞–≤—à–∏–µ –∫–æ–Ω—Ñ–µ—Ç—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                match.forEach(([row, col]) => {
                    if (!matchedCells.some(cell => cell[0] === row && cell[1] === col)) {
                        matchedCells.push([row, col]);
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–µ—Ç—ã
                        const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                        if (cell) {
                            const animation = document.createElement('div');
                            animation.className = 'match-animation';
                            cell.appendChild(animation);
                            
                            setTimeout(() => {
                                animation.remove();
                            }, 300);
                        }
                    }
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π —Ä—è–¥–æ–º —Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏
            const affectedObstacles = new Set();
            const explosionCells = [];
            
            matches.forEach(match => {
                match.forEach(([row, col]) => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                    const neighbors = [
                        [row-1, col], [row+1, col], [row, col-1], [row, col+1]
                    ];
                    
                    neighbors.forEach(([nRow, nCol]) => {
                        if (nRow >= 0 && nRow < boardSize && nCol >= 0 && nCol < boardSize) {
                            const obstacle = getObstacleAt(nRow, nCol);
                            if (obstacle) {
                                affectedObstacles.add(`${nRow},${nCol}`);
                                
                                // –î–ª—è –∫–∞–º–Ω—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–≤–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ä—è–¥–æ–º
                                if (obstacle.type === OBSTACLES.STONE) {
                                    obstacle.hits = (obstacle.hits || 0) + 1;
                                    if (obstacle.hits >= 2) {
                                        removeObstacle(nRow, nCol);
                                    }
                                } 
                                // –î–ª—è –ª—å–¥–∞ - –æ–¥–∏–Ω —É–¥–∞—Ä
                                else if (obstacle.type === OBSTACLES.ICE) {
                                    removeObstacle(nRow, nCol);
                                }
                                // –î–ª—è –ª–∞–≤—ã - –¥–≤–∞ —É–¥–∞—Ä–∞, –ø—Ä–∏ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–∏ –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è
                                else if (obstacle.type === OBSTACLES.LAVA) {
                                    obstacle.hits = (obstacle.hits || 0) + 1;
                                    if (obstacle.hits >= 2) {
                                        explosionCells.push([nRow, nCol]);
                                        removeObstacle(nRow, nCol);
                                    }
                                }
                                // –î–ª—è –∑–∞–º–∫–∞ - —Ç—Ä–∏ —É–¥–∞—Ä–∞
                                else if (obstacle.type === OBSTACLES.LOCK) {
                                    obstacle.hits = (obstacle.hits || 0) + 1;
                                    if (obstacle.hits >= 3) {
                                        removeObstacle(nRow, nCol);
                                    }
                                }
                            }
                        }
                    });
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∑—Ä—ã–≤–æ–≤ –ª–∞–≤—ã
            explosionCells.forEach(([row, col]) => {
                const directions = [
                    [-1, 0], [1, 0], [0, -1], [0, 1]
                ];
                
                directions.forEach(([dx, dy]) => {
                    const newRow = row + dx;
                    const newCol = col + dy;
                    if (newRow >= 0 && newRow < boardSize && newCol >= 0 && newCol < boardSize) {
                        matchedCells.push([newRow, newCol]);
                        removeObstacle(newRow, newCol);
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è –≤–∑—Ä—ã–≤–∞
                        const cell = document.querySelector(`.cell[data-row="${newRow}"][data-col="${newCol}"]`);
                        if (cell) {
                            const explosion = document.createElement('div');
                            explosion.className = 'explosion';
                            cell.appendChild(explosion);
                            
                            setTimeout(() => {
                                explosion.remove();
                            }, 500);
                        }
                    }
                });
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
            gameState.score += totalScore;
            updateUI();
            
            // –£–¥–∞–ª—è–µ–º —Å–æ–≤–ø–∞–≤—à–∏–µ –∫–æ–Ω—Ñ–µ—Ç—ã
            setTimeout(() => {
                matchedCells.forEach(([row, col]) => {
                    // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –∏–ª–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –±—ã–ª–æ —Ä–∞–∑—Ä—É—à–µ–Ω–æ
                    if (!getObstacleAt(row, col)) {
                        gameState.board[row][col] = 0;
                        updateCell(row, col);
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–µ—Ç—ã
                specialCells.forEach(({row, col, type}) => {
                    gameState.board[row][col] = type;
                    updateCell(row, col);
                });
                
                // –°–¥–≤–∏–≥–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—ã
                dropCandies();
            }, 300);
        }
        
        // –°–¥–≤–∏–≥ –∫–æ–Ω—Ñ–µ—Ç –≤–Ω–∏–∑
        function dropCandies() {
            const boardSize = getBoardSize();
            let moved = false;
            gameState.fallFrom = {};
            
            // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å—Ç–æ–ª–±—Ü–∞–º
            for (let col = 0; col < boardSize; col++) {
                // –ù–∞—á–∏–Ω–∞–µ–º —Å –Ω–∏–∂–Ω–µ–π —Å—Ç—Ä–æ–∫–∏
                let emptySpaces = 0;
                for (let row = boardSize - 1; row >= 0; row--) {
                    // –ï—Å–ª–∏ —è—á–µ–π–∫–∞ –ø—É—Å—Ç–∞ –∏ –Ω–µ—Ç –∫–∞–º–Ω—è
                    const obstacle = getObstacleAt(row, col);
                    if (gameState.board[row][col] === 0 && 
                        (!obstacle || obstacle.type !== OBSTACLES.STONE)) {
                        emptySpaces++;
                    } else if (emptySpaces > 0) {
                        // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—É –≤–Ω–∏–∑
                        const newRow = row + emptySpaces;
                        if (newRow < boardSize) {
                            gameState.board[newRow][col] = gameState.board[row][col];
                            gameState.board[row][col] = 0;
                            
                            // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                            gameState.fallFrom[`${newRow},${col}`] = [row, col];
                            moved = true;
                        }
                    }
                }
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤–µ—Ä—Ö–Ω–∏–µ –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –Ω–æ–≤—ã–º–∏ –∫–æ–Ω—Ñ–µ—Ç–∞–º–∏
                for (let row = 0; row < emptySpaces; row++) {
                    const obstacle = getObstacleAt(row, col);
                    if (!obstacle || obstacle.type !== OBSTACLES.STONE) {
                        gameState.board[row][col] = Math.floor(Math.random() * CANDY_TYPES) + 1;
                        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –∫–æ–Ω—Ñ–µ—Ç–∞ –ø–∞–¥–∞–µ—Ç —Å–≤–µ—Ä—Ö—É
                        gameState.fallFrom[`${row},${col}`] = [row - emptySpaces, col];
                        moved = true;
                    }
                }
            }
            
            if (moved) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —è—á–µ–π–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col < boardSize; col++) {
                        updateCell(row, col);
                    }
                }
                
                setTimeout(() => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                    const newMatches = findMatches();
                    
                    if (newMatches.length > 0) {
                        processMatches(newMatches);
                    } else {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ –ª–∏ —Ü–µ–ª—å —É—Ä–æ–≤–Ω—è
                        if (gameState.score >= gameState.target) {
                            showLevelCompleteModal();
                        } else {
                            gameState.isProcessing = false;
                            gameState.isSwapping = false;
                            gameState.selectedCandy = null;
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ —Ö–æ–¥—ã
                            if (!hasMoves()) {
                                // –ï—Å–ª–∏ —Ö–æ–¥–æ–≤ –Ω–µ—Ç - –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–ª–µ
                                setTimeout(() => {
                                    generateBoard();
                                    renderBoard();
                                    gameState.isProcessing = false;
                                }, 300);
                            }
                        }
                    }
                }, 300);
            } else {
                gameState.isProcessing = false;
                gameState.isSwapping = false;
                gameState.selectedCandy = null;
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function showLevelCompleteModal() {
            completedLevelElement.textContent = gameState.level;
            levelScoreElement.textContent = formatNumber(gameState.score);
            levelCompleteModal.classList.remove('hidden');
        }
        
        // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
        function goToNextLevel() {
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
            gameState.level++;
            gameState.target = Math.floor(1000 * Math.pow(LEVEL_TARGET_MULTIPLIER, gameState.level - 1));
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            saveGameState();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUI();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–µ –ø–æ–ª–µ
            generateBoard();
            renderBoard();
            
            gameState.isProcessing = false;
            gameState.isSwapping = false;
            gameState.selectedCandy = null;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ 2, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏
            if (gameState.level === 2 && !gameState.tutorialShown) {
                tutorialModal.classList.remove('hidden');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            scoreElement.textContent = formatNumber(gameState.score);
            levelElement.textContent = gameState.level;
            targetElement.textContent = formatNumber(gameState.target);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è
            const progressPercent = Math.min(100, (gameState.score / gameState.target) * 100);
            levelProgress.style.width = `${progressPercent}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (gameState.score > gameState.bestScore) {
                gameState.bestScore = gameState.score;
            }
            bestScoreElement.textContent = formatNumber(gameState.bestScore);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            saveGameState();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
        function showHints() {
            if (gameState.isProcessing || gameState.isPaused) return;
            
            // –°–Ω–∏–º–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
            document.querySelectorAll('.hint').forEach(el => {
                el.classList.remove('hint');
            });
            
            // –ù–∞—Ö–æ–¥–∏–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã
            const moves = findPossibleMoves();
            if (moves.length === 0) return;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 —Ö–æ–¥–∞
            showNextHint(moves, 0);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
        function showNextHint(moves, index) {
            if (index >= moves.length || index >= 3) return;
            
            const [row1, col1, row2, col2] = moves[index];
            const cell1 = document.querySelector(`.cell[data-row="${row1}"][data-col="${col1}"]`);
            const cell2 = document.querySelector(`.cell[data-row="${row2}"][data-col="${col2}"]`);
            
            if (cell1 && cell2) {
                cell1.classList.add('hint');
                cell2.classList.add('hint');
                
                setTimeout(() => {
                    cell1.classList.remove('hint');
                    cell2.classList.remove('hint');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
                    setTimeout(() => {
                        showNextHint(moves, index + 1);
                    }, 300);
                }, 1000);
            }
        }
        
        // –ù–∞–π—Ç–∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã
        function findPossibleMoves() {
            const boardSize = getBoardSize();
            const moves = [];
            const tempBoard = JSON.parse(JSON.stringify(gameState.board));
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ–±–º–µ–Ω—ã
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    // –ü—Ä–æ–±—É–µ–º –æ–±–º–µ–Ω –≤–ø—Ä–∞–≤–æ
                    if (col < boardSize - 1) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
                        const obstacle1 = getObstacleAt(row, col);
                        const obstacle2 = getObstacleAt(row, col+1);
                        if ((obstacle1 && (obstacle1.type === OBSTACLES.STONE || obstacle1.type === OBSTACLES.LOCK)) || 
                            (obstacle2 && (obstacle2.type === OBSTACLES.STONE || obstacle2.type === OBSTACLES.LOCK))) continue;
                        
                        // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏
                        [tempBoard[row][col], tempBoard[row][col+1]] = [tempBoard[row][col+1], tempBoard[row][col]];
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                        if (checkMatchesForBoard(tempBoard).length > 0) {
                            moves.push([row, col, row, col+1]);
                        }
                        
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                        [tempBoard[row][col], tempBoard[row][col+1]] = [tempBoard[row][col+1], tempBoard[row][col]];
                    }
                    
                    // –ü—Ä–æ–±—É–µ–º –æ–±–º–µ–Ω –≤–Ω–∏–∑
                    if (row < boardSize - 1) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
                        const obstacle1 = getObstacleAt(row, col);
                        const obstacle2 = getObstacleAt(row+1, col);
                        if ((obstacle1 && (obstacle1.type === OBSTACLES.STONE || obstacle1.type === OBSTACLES.LOCK)) || 
                            (obstacle2 && (obstacle2.type === OBSTACLES.STONE || obstacle2.type === OBSTACLES.LOCK))) continue;
                        
                        // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏
                        [tempBoard[row][col], tempBoard[row+1][col]] = [tempBoard[row+1][col], tempBoard[row][col]];
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                        if (checkMatchesForBoard(tempBoard).length > 0) {
                            moves.push([row, col, row+1, col]);
                        }
                        
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                        [tempBoard[row][col], tempBoard[row+1][col]] = [tempBoard[row+1][col], tempBoard[row][col]];
                    }
                }
            }
            
            return moves;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–π –¥–æ—Å–∫–∏
        function checkMatchesForBoard(board) {
            const boardSize = getBoardSize();
            const matches = [];
            const visited = new Set();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize - 2; col++) {
                    const candyType = board[row][col];
                    if (candyType === 0 || candyType >= 50) continue; // –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞ –∏–ª–∏ —Å–ø–µ—Ü. –∫–æ–Ω—Ñ–µ—Ç–∞
                    
                    if (candyType === board[row][col+1] && 
                        candyType === board[row][col+2]) {
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—Ö–æ–¥–∏—Ç –ª–∏ —É–∂–µ —ç—Ç–∞ —è—á–µ–π–∫–∞ –≤ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                        if (visited.has(`${row},${col}`)) continue;
                        
                        const match = [[row, col], [row, col+1], [row, col+2]];
                        visited.add(`${row},${col}`);
                        visited.add(`${row},${col+1}`);
                        visited.add(`${row},${col+2}`);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª–∏–Ω–Ω–µ–µ 3
                        let nextCol = col + 3;
                        while (nextCol < boardSize && board[row][nextCol] === candyType) {
                            match.push([row, nextCol]);
                            visited.add(`${row},${nextCol}`);
                            nextCol++;
                        }
                        
                        matches.push(match);
                    }
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            for (let row = 0; row < boardSize - 2; row++) {
                for (let col = 0; col < boardSize; col++) {
                    const candyType = board[row][col];
                    if (candyType === 0 || candyType >= 50) continue; // –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞ –∏–ª–∏ —Å–ø–µ—Ü. –∫–æ–Ω—Ñ–µ—Ç–∞
                    
                    if (candyType === board[row+1][col] && 
                        candyType === board[row+2][col]) {
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—Ö–æ–¥–∏—Ç –ª–∏ —É–∂–µ —ç—Ç–∞ —è—á–µ–π–∫–∞ –≤ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                        if (visited.has(`${row},${col}`)) continue;
                        
                        const match = [[row, col], [row+1, col], [row+2, col]];
                        visited.add(`${row},${col}`);
                        visited.add(`${row+1},${col}`);
                        visited.add(`${row+2},${col}`);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª–∏–Ω–Ω–µ–µ 3
                        let nextRow = row + 3;
                        while (nextRow < boardSize && board[nextRow][col] === candyType) {
                            match.push([nextRow, col]);
                            visited.add(`${nextRow},${col}`);
                            nextRow++;
                        }
                        
                        matches.push(match);
                    }
                }
            }
            
            return matches;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
        function hasMoves() {
            return findPossibleMoves().length > 0;
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>